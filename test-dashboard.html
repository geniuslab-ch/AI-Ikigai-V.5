<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Test Dashboard - NO CACHE</title>
</head>

<body>
    <h1>Test Dashboard (Sans Cache)</h1>
    <div id="debug"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js?nocache=<?php echo time(); ?>"></script>

    <script>
        const debug = document.getElementById('debug');

        async function testDashboard() {
            debug.innerHTML += '<p><strong>TEST DÉMARRÉ...</strong></p>';

            try {
                debug.innerHTML += '<p>1. Appel checkAuth...</p>';
                const user = await checkAuth('client');

                if (user) {
                    debug.innerHTML += `<p style="color: green;">✅ SUCCESS! User: ${user.email}</p>`;
                    debug.innerHTML += `<p>Role: ${user.role}</p>`;
                    debug.innerHTML += `<p>Plan: ${user.plan || 'N/A'}</p>`;
                } else {
                    debug.innerHTML += '<p style="color: red;">❌ checkAuth returned null</p>';
                }
            } catch (error) {
                debug.innerHTML += `<p style="color: red;">❌ ERROR: ${error.message}</p>`;
                console.error('Full error:', error);
            }
        }

        // Lancer test au chargement
        testDashboard();
    </script>
</body>

</html>